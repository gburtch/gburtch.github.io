knitr::opts_chunk$set(echo = TRUE)
# I create an empty data frame to store all the simulation results, based on the simulation paramters
sim_result <- expand.grid(periods = seq(from=2,to=panel_max,by=1),run = seq(sims))
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(survival)
library(patchwork)
library(bife)
library(ggthemes)
library(ggridges)
library(boot)
library(texreg)
library(splitstackshape)
# I begin by setting some simulation parameters.
set.seed(12345)
n <- 25
sims <- 50
panel_max <- 20
# Lastly, for each panel unit
confound <- rnorm(n, mean = 0, sd=1)
id <- seq(n)
treatment_grp <- rbinom(n=n, size=1, prob=confound > median(confound))
df <- data.frame(confound=confound,id = id, treatment_grp = treatment_grp)
# I create an empty data frame to store all the simulation results, based on the simulation paramters
sim_result <- expand.grid(periods = seq(from=2,to=panel_max,by=1),run = seq(sims))
# Simulate each panel length 50 times and re-run all models.
for (r in 1:sims){
for (p in seq(from=2,to=panel_max,by=1)){
# Simulate a panel of p periods.
# Make the data with whole panel length
df_tmp <- expandRows(df, count=p, count.is.col=FALSE)
# Treatment begins midway through the panel for treated units.
df_tmp <- df_tmp %>% group_by(id) %>% mutate(period = seq(from=1,to=p,by=1)) %>% mutate(Treat = (period > floor((p+1)/2))*treatment_grp) %>% arrange(treatment_grp,id,period) %>% select(-c(treatment_grp))
df_tmp$Treat_center <- df_tmp$Treat - mean(df_tmp$Treat)
df_tmp$xb <- 2*df_tmp$Treat_center + 4*df_tmp$confound
df_tmp$p <- inv.logit(df_tmp$xb)
df_tmp$Y <- rbinom(nrow(df_tmp),size=1, prob=df_tmp$p)
# Estimate our four logit models.
logit_mod_control <- glm(data=df_tmp,Y ~ Treat_center + confound, family = "binomial")
logit_mod_omit <- glm(data=df_tmp,Y ~ Treat_center, family = "binomial")
logit_mod_fe <- clogit(data=df_tmp,Y ~ Treat_center + strata(id))
logit_mod_ipp <- glm(data=df_tmp,Y ~ Treat_center + factor(id), family = "binomial")
# Sometimes the analytical correction fails, and it doesn't handle it well.
# Note: usually when bife fails, clogit will also fail to converge and reports NA.
tryCatch(
{
# Let's set a placeholder result to NA in case the estimation fails.
logit_mod_bife <- data.frame(coefficients=NA)
suppressWarnings(logit_mod_bife <- bias_corr(bife(Y~Treat_center | id,data=df_tmp)))
},error=function(cond){
# BIFE crapped out.
return(logit_mod_bife)
},warning=function(cond){
# BIFE generated a warning.
}
)
sim_result_row <- data.frame(cbind(periods=p,run=r,b_control=logit_mod_control$coefficients[2],b_omit=logit_mod_omit$coefficients[2],b_fe=logit_mod_fe$coefficients[1],b_ipp=logit_mod_ipp$coefficients[2],b_bife=logit_mod_bife$coefficients[1]))
sim_result <- sim_result %>% left_join(sim_result_row,by=c("periods","run"))
sim_result$b_control.y[is.na(sim_result$b_control.y) ] <- sim_result$b_control.x[ is.na(sim_result$b_control.y)]
sim_result$b_omit.y[is.na(sim_result$b_omit.y) ] <- sim_result$b_omit.x[ is.na(sim_result$b_omit.y)]
sim_result$b_fe.y[is.na(sim_result$b_fe.y) ] <- sim_result$b_fe.x[ is.na(sim_result$b_fe.y)]
sim_result$b_ipp.y[is.na(sim_result$b_ipp.y) ] <- sim_result$b_ipp.x[ is.na(sim_result$b_ipp.y)]
sim_result$b_bife.y[is.na(sim_result$b_bife.y) ] <- sim_result$b_bife.x[ is.na(sim_result$b_bife.y)]
if("b_control.y" %in% colnames(sim_result)){
sim_result <- sim_result %>% select(-c(b_control.x, b_omit.x, b_fe.x, b_ipp.x,b_bife.x)) %>% rename(b_control=b_control.y, b_omit = b_omit.y, b_fe = b_fe.y, b_ipp = b_ipp.y, b_bife = b_bife.y)
}
}
}
screenreg(list(logit_mod_omit,logit_mod_ipp,logit_mod_bife,logit_mod_fe,logit_mod_control),digits=3,omit.coef=c("factor|Intercept|confound"),custom.model.names=c("logit","logit + dummies","bife","clogit","logit + control"))
# Plot distribution of Treatment coefficient - truth across simulations.
control <- ggplot(data=sim_result,aes(x=b_control,y=factor(periods))) + geom_density_ridges(data=sim_result,size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off")  + ggtitle("Control (Oracle)")
omit <- ggplot(data=sim_result,aes(x=b_omit,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Naive (Ignoring the Confound)")
clogit <- ggplot(data=sim_result,aes(x=b_fe,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Conditional Logit)")
dummy <- ggplot(data=sim_result,aes(x=b_ipp,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Dummy FEs (Incidental Parameter Problem)")
bife <- ggplot(data=sim_result,aes(x=b_bife,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("BIFE (Dummy FEs + Analytical Correction)")
(omit + dummy) / (bife + clogit) + plot_annotation('Performance of Logistic Regression Alternatives Under Confounding', caption = 'Dummy FEs are quite bad in short panels.')
# I begin by setting some simulation parameters.
set.seed(12345)
n <- 100
sims <- 50
panel_max <- 10
# Lastly, for each panel unit
confound <- rnorm(n, mean = 0, sd=1)
id <- seq(n)
treatment_grp <- rbinom(n=n, size=1, prob=confound > median(confound))
df <- data.frame(confound=confound,id = id, treatment_grp = treatment_grp)
# I create an empty data frame to store all the simulation results, based on the simulation paramters
sim_result <- expand.grid(periods = seq(from=2,to=panel_max,by=1),run = seq(sims))
# Simulate each panel length 50 times and re-run all models.
for (r in 1:sims){
for (p in seq(from=2,to=panel_max,by=1)){
# Simulate a panel of p periods.
# Make the data with whole panel length
df_tmp <- expandRows(df, count=p, count.is.col=FALSE)
# Treatment begins midway through the panel for treated units.
df_tmp <- df_tmp %>% group_by(id) %>% mutate(period = seq(from=1,to=p,by=1)) %>% mutate(Treat = (period > floor((p+1)/2))*treatment_grp) %>% arrange(treatment_grp,id,period) %>% select(-c(treatment_grp))
df_tmp$Treat_center <- df_tmp$Treat - mean(df_tmp$Treat)
df_tmp$xb <- 2*df_tmp$Treat_center + 4*df_tmp$confound
df_tmp$p <- inv.logit(df_tmp$xb)
df_tmp$Y <- rbinom(nrow(df_tmp),size=1, prob=df_tmp$p)
# Estimate our four logit models.
logit_mod_control <- glm(data=df_tmp,Y ~ Treat_center + confound, family = "binomial")
logit_mod_omit <- glm(data=df_tmp,Y ~ Treat_center, family = "binomial")
logit_mod_fe <- clogit(data=df_tmp,Y ~ Treat_center + strata(id))
logit_mod_ipp <- glm(data=df_tmp,Y ~ Treat_center + factor(id), family = "binomial")
# Sometimes the analytical correction fails, and it doesn't handle it well.
# Note: usually when bife fails, clogit will also fail to converge and reports NA.
tryCatch(
{
# Let's set a placeholder result to NA in case the estimation fails.
logit_mod_bife <- data.frame(coefficients=NA)
suppressWarnings(logit_mod_bife <- bias_corr(bife(Y~Treat_center | id,data=df_tmp)))
},error=function(cond){
# BIFE crapped out.
return(logit_mod_bife)
},warning=function(cond){
# BIFE generated a warning.
return(logit_mod_bife)
}
)
sim_result_row <- data.frame(cbind(periods=p,run=r,b_control=logit_mod_control$coefficients[2],b_omit=logit_mod_omit$coefficients[2],b_fe=logit_mod_fe$coefficients[1],b_ipp=logit_mod_ipp$coefficients[2],b_bife=logit_mod_bife$coefficients[1]))
sim_result <- sim_result %>% left_join(sim_result_row,by=c("periods","run"))
sim_result$b_control.y[is.na(sim_result$b_control.y) ] <- sim_result$b_control.x[ is.na(sim_result$b_control.y)]
sim_result$b_omit.y[is.na(sim_result$b_omit.y) ] <- sim_result$b_omit.x[ is.na(sim_result$b_omit.y)]
sim_result$b_fe.y[is.na(sim_result$b_fe.y) ] <- sim_result$b_fe.x[ is.na(sim_result$b_fe.y)]
sim_result$b_ipp.y[is.na(sim_result$b_ipp.y) ] <- sim_result$b_ipp.x[ is.na(sim_result$b_ipp.y)]
sim_result$b_bife.y[is.na(sim_result$b_bife.y) ] <- sim_result$b_bife.x[ is.na(sim_result$b_bife.y)]
if("b_control.y" %in% colnames(sim_result)){
sim_result <- sim_result %>% select(-c(b_control.x, b_omit.x, b_fe.x, b_ipp.x,b_bife.x)) %>% rename(b_control=b_control.y, b_omit = b_omit.y, b_fe = b_fe.y, b_ipp = b_ipp.y, b_bife = b_bife.y)
}
}
}
screenreg(list(logit_mod_omit,logit_mod_ipp,logit_mod_bife,logit_mod_fe,logit_mod_control),digits=3,omit.coef=c("factor|Intercept|confound"),custom.model.names=c("logit","logit + dummies","bife","clogit","logit + control"))
# Plot distribution of Treatment coefficient - truth across simulations.
control <- ggplot(data=sim_result,aes(x=b_control,y=factor(periods))) + geom_density_ridges(data=sim_result,size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off")  + ggtitle("Control (Oracle)")
omit <- ggplot(data=sim_result,aes(x=b_omit,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Naive (Ignoring the Confound)")
clogit <- ggplot(data=sim_result,aes(x=b_fe,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Conditional Logit)")
dummy <- ggplot(data=sim_result,aes(x=b_ipp,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Dummy FEs (Incidental Parameter Problem)")
bife <- ggplot(data=sim_result,aes(x=b_bife,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("BIFE (Dummy FEs + Analytical Correction)")
(omit + dummy) / (bife + clogit) + plot_annotation('Performance of Logistic Regression Alternatives Under Confounding', caption = 'Dummy FEs are quite bad in short panels.')
# Plot distribution of Treatment coefficient - truth across simulations.
control <- ggplot(data=sim_result,aes(x=b_control,y=factor(periods))) + geom_density_ridges(data=sim_result,size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off")  + ggtitle("Control (Oracle)") + xlim(-1,7)
omit <- ggplot(data=sim_result,aes(x=b_omit,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Naive (Ignoring the Confound)") + xlim(-1,7)
clogit <- ggplot(data=sim_result,aes(x=b_fe,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Conditional Logit)") + xlim(-1,7)
dummy <- ggplot(data=sim_result,aes(x=b_ipp,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Dummy FEs (Incidental Parameter Problem)") + xlim(-1,7)
bife <- ggplot(data=sim_result,aes(x=b_bife,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("BIFE (Dummy FEs + Analytical Correction)") + xlim(-1,7)
(omit + dummy) / (bife + clogit)
# Plot distribution of Treatment coefficient - truth across simulations.
control <- ggplot(data=sim_result,aes(x=b_control,y=factor(periods))) + geom_density_ridges(data=sim_result,size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off")  + ggtitle("Control (Oracle)") + xlim(-1,10)
omit <- ggplot(data=sim_result,aes(x=b_omit,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Naive (Ignoring the Confound)") + xlim(-1,10)
clogit <- ggplot(data=sim_result,aes(x=b_fe,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Conditional Logit)") + xlim(-1,10)
dummy <- ggplot(data=sim_result,aes(x=b_ipp,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Dummy FEs (Incidental Parameter Problem)") + xlim(-1,10)
bife <- ggplot(data=sim_result,aes(x=b_bife,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("BIFE (Dummy FEs + Analytical Correction)") + xlim(-1,10)
(omit + dummy) / (bife + clogit)
# I begin by setting some simulation parameters.
set.seed(12345)
n <- 100
sims <- 100
panel_max <- 10
# Lastly, for each panel unit
confound <- rnorm(n, mean = 0, sd=1)
id <- seq(n)
treatment_grp <- rbinom(n=n, size=1, prob=confound > median(confound))
df <- data.frame(confound=confound,id = id, treatment_grp = treatment_grp)
# I create an empty data frame to store all the simulation results, based on the simulation paramters
sim_result <- expand.grid(periods = seq(from=2,to=panel_max,by=1),run = seq(sims))
# Simulate each panel length 50 times and re-run all models.
for (r in 1:sims){
for (p in seq(from=2,to=panel_max,by=1)){
# Simulate a panel of p periods.
# Make the data with whole panel length
df_tmp <- expandRows(df, count=p, count.is.col=FALSE)
# Treatment begins midway through the panel for treated units.
df_tmp <- df_tmp %>% group_by(id) %>% mutate(period = seq(from=1,to=p,by=1)) %>% mutate(Treat = (period > floor((p+1)/2))*treatment_grp) %>% arrange(treatment_grp,id,period) %>% select(-c(treatment_grp))
df_tmp$Treat_center <- df_tmp$Treat - mean(df_tmp$Treat)
df_tmp$xb <- 2*df_tmp$Treat_center + 4*df_tmp$confound
df_tmp$p <- inv.logit(df_tmp$xb)
df_tmp$Y <- rbinom(nrow(df_tmp),size=1, prob=df_tmp$p)
# Estimate our four logit models.
logit_mod_control <- glm(data=df_tmp,Y ~ Treat_center + confound, family = "binomial")
logit_mod_omit <- glm(data=df_tmp,Y ~ Treat_center, family = "binomial")
logit_mod_fe <- clogit(data=df_tmp,Y ~ Treat_center + strata(id))
logit_mod_ipp <- glm(data=df_tmp,Y ~ Treat_center + factor(id), family = "binomial")
# Sometimes the analytical correction fails, and it doesn't handle it well.
# Note: usually when bife fails, clogit will also fail to converge and reports NA.
tryCatch(
{
# Let's set a placeholder result to NA in case the estimation fails.
logit_mod_bife <- data.frame(coefficients=NA)
suppressWarnings(logit_mod_bife <- bias_corr(bife(Y~Treat_center | id,data=df_tmp)))
},error=function(cond){
# BIFE crapped out.
return(logit_mod_bife)
},warning=function(cond){
# BIFE generated a warning.
return(logit_mod_bife)
}
)
sim_result_row <- data.frame(cbind(periods=p,run=r,b_control=logit_mod_control$coefficients[2],b_omit=logit_mod_omit$coefficients[2],b_fe=logit_mod_fe$coefficients[1],b_ipp=logit_mod_ipp$coefficients[2],b_bife=logit_mod_bife$coefficients[1]))
sim_result <- sim_result %>% left_join(sim_result_row,by=c("periods","run"))
sim_result$b_control.y[is.na(sim_result$b_control.y) ] <- sim_result$b_control.x[ is.na(sim_result$b_control.y)]
sim_result$b_omit.y[is.na(sim_result$b_omit.y) ] <- sim_result$b_omit.x[ is.na(sim_result$b_omit.y)]
sim_result$b_fe.y[is.na(sim_result$b_fe.y) ] <- sim_result$b_fe.x[ is.na(sim_result$b_fe.y)]
sim_result$b_ipp.y[is.na(sim_result$b_ipp.y) ] <- sim_result$b_ipp.x[ is.na(sim_result$b_ipp.y)]
sim_result$b_bife.y[is.na(sim_result$b_bife.y) ] <- sim_result$b_bife.x[ is.na(sim_result$b_bife.y)]
if("b_control.y" %in% colnames(sim_result)){
sim_result <- sim_result %>% select(-c(b_control.x, b_omit.x, b_fe.x, b_ipp.x,b_bife.x)) %>% rename(b_control=b_control.y, b_omit = b_omit.y, b_fe = b_fe.y, b_ipp = b_ipp.y, b_bife = b_bife.y)
}
}
}
screenreg(list(logit_mod_omit,logit_mod_ipp,logit_mod_bife,logit_mod_fe,logit_mod_control),digits=3,omit.coef=c("factor|Intercept|confound"),custom.model.names=c("logit","logit + dummies","bife","clogit","logit + control"))
# Plot distribution of Treatment coefficient - truth across simulations.
control <- ggplot(data=sim_result,aes(x=b_control,y=factor(periods))) + geom_density_ridges(data=sim_result,size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off")  + ggtitle("Control (Oracle)")
omit <- ggplot(data=sim_result,aes(x=b_omit,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Naive (Ignoring the Confound)")
clogit <- ggplot(data=sim_result,aes(x=b_fe,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Conditional Logit)")
dummy <- ggplot(data=sim_result,aes(x=b_ipp,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Dummy FEs (Incidental Parameter Problem)")
bife <- ggplot(data=sim_result,aes(x=b_bife,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("BIFE (Dummy FEs + Analytical Correction)")
(omit + dummy) / (bife + clogit) + plot_annotation('Performance of Logistic Regression Alternatives Under Confounding', caption = 'Dummy FEs are quite bad in short panels.')
# Plot distribution of Treatment coefficient - truth across simulations.
control <- ggplot(data=sim_result,aes(x=b_control,y=factor(periods))) + geom_density_ridges(data=sim_result,size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off")  + ggtitle("Control (Oracle)") + xlim(-1,10)
omit <- ggplot(data=sim_result,aes(x=b_omit,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Naive (Ignoring the Confound)") + xlim(-1,10)
clogit <- ggplot(data=sim_result,aes(x=b_fe,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Conditional Logit)") + xlim(-1,10)
dummy <- ggplot(data=sim_result,aes(x=b_ipp,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("Dummy FEs (Incidental Parameter Problem)") + xlim(-1,10)
bife <- ggplot(data=sim_result,aes(x=b_bife,y=factor(periods))) + geom_density_ridges(size = 0.5,rel_min_height=0.010,fill="lightblue") + ylab("Panel Length") + xlab("Estimated Parameter") + theme(text = element_text(family = "Economica", size = 10)) + ggtitle(paste0("Treatment")) + geom_vline(xintercept=2,color="red") + coord_cartesian(clip = "off") + ggtitle("BIFE (Dummy FEs + Analytical Correction)") + xlim(-1,10)
(omit + dummy) / (bife + clogit)
